<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>服务人员管理</title>
		<meta name="keywords" content="服务人员管理">
		<meta name="服务人员管理">
		<include file='Public:common_file' />
	</head>
	<body class="gray-bg">
	    <!--<div class="row wrapper border-bottom white-bg page-heading">
	        <div class="col-sm-4">
	            <h2>服务人员管理</h2>
	            <ol class="breadcrumb">
	                <li>
	                    <a href="javascript:void(0);">主页</a>
	                </li>
	                <li>
	                    <a href="javascript:void(0);">系统管理</a>
	                </li>
	                <li>
	                    <strong>服务人员管理</strong>
	                </li>
	            </ol>
	        </div>
	    </div>--> 
		<div class="wrapper wrapper-content animated">
			<div class="ibox float-e-margins">
				<!-- Panel Style -->
				<div class="ibox float-e-margins">
					<div class="ibox-title">
						<h5>服务人员管理</h5>
						<div class="ibox-tools">
							<a class="collapse-link">
								<i class="fa fa-chevron-up"></i>
							</a>
							<a class="close-link">
								<i class="fa fa-times"></i>
							</a>
						</div>
					</div>
					<div class="ibox-content">
						<div class="row row-lg">
							<div class="col-sm-12 me-search" >
	                                <input id="search_name" style="width: 250px;" placeholder="请输入服务人员姓名或工号" type="text"  class="form-control" >
									<select style="width: 150px;" class="form-control" name = "communityid"
                                    id= "communityid" required="true">
                                        <option selected="" value = "">请选择社区</option>
                                        <volist name = "cname" id="volist">
                                        <option value="{$volist.id}">{$volist.name}</option>
                                        </volist>
                                    </select>
	                                <button onclick="searchSubmit()" type="button" id="search_btn" class="btn btn-w-s btn-primary">搜索</button>
							</div>
						</div>
						<div class="row row-lg">
							<div class="col-sm-12">
								<div class="example-wrap">
									<div class="example">
										<div class="btn-group hidden-xs" id="table-toolbar" role="group">
											<button type="button" class="btn btn-outline btn-default J_showdialog" data-uri='{:U("add")}' data-title="添加" data-width="1000" data-height="800">
		                                        <i class="glyphicon glyphicon-plus" aria-hidden="true"></i>
		                                    </button>
		                                    <button type="button" class="btn btn-outline btn-default J_batchDelete"  data-uri="{:U('ajax_delete')}">
		                                        <i class="glyphicon glyphicon-trash" aria-hidden="true"></i>
		                                    </button>
										</div>
										<table id="tablelist" class="table table-hover table-condensed">
										</table>
									</div>
								</div>
							</div>
						</div> 
					</div>
				</div>
				<!-- End Panel Style -->
			</div>
		</div>
		<!-- 全局js -->
		<include file='Public:common_js' />
		<!-- Bootstrap table begin-->
		<link href="__PUBLIC__/hplus/css/plugins/bootstrap-table/bootstrap-table.min.css" rel="stylesheet">
		<script src="__PUBLIC__/system/js/bootstrap-table.config.js"></script>
		<script src="__PUBLIC__/hplus/js/plugins/bootstrap-table/bootstrap-table.min.js"></script>
		<script src="__PUBLIC__/hplus/js/plugins/bootstrap-table/bootstrap-table-mobile.min.js"></script>
		<script src="__PUBLIC__/hplus/js/plugins/bootstrap-table/locale/bootstrap-table-zh-CN.min.js"></script>
		<!-- Bootstrap table end-->

		<!--layer begin-->
		<script src="__PUBLIC__/hplus/js/plugins/layer/layer.min.js"></script>
		<!--layer end-->

		<!--sweetalert begin-->
		<link href="__PUBLIC__/hplus/css/plugins/sweetalert/sweetalert.css" rel="stylesheet">
		<script src="__PUBLIC__/hplus/js/plugins/sweetalert/sweetalert.min.js"></script>
		<!--sweetalert end-->

		
		<script type="text/javascript">
			var url = "{:U('ajax_getList')}";
			// 搜索 （根据条件重新加载数据）
			function searchSubmit(){
				$("#tablelist").bootstrapTable("removeAll");
				$('#tablelist').bootstrapTable('refresh', {
					silent: true, 
					query: {
						name: $("#search_name").val(),
						communityid: $("#communityid").val()
					}
				});
			}
			$(function() {
				/***初始化数据表格 begin***/
				$('#tablelist').bootstrapTable($.extend(true, bootstrap_table.datagridDefaultConfig, {
					//工具按钮用哪个容器
					toolbar: '#table-toolbar',
					//请求地址
					url: url,
					//显示切换视图
					showToggle: true,
					//排序字段名称
					sortName: "ru.id",
					//排序方式
					sortOrder: "desc",
					iconSize: 'outline',
					showColumns: true,
					icons: {
						refresh: 'glyphicon-repeat',
						toggle: 'glyphicon-list-alt',
						columns: 'glyphicon-list'
					},
					columns: [{
						field: 'checkbox',
						title: '',
						checkbox: true,
						align: 'center'		
					},
					{
						field: 'id',
						title: 'ID',
						sortable: true,
						align: 'left'
					},
					{
						field: 'pet_name',
						sortable: true,
						title: '姓名',
						align: 'left'
					},
					{
						field: 'sex',
						sortable: true,
						title: '性别',
						align: 'left'
					},
					{
						field: 'job_number',
						sortable: true,
						title: '工号',
						align: 'left'
					},
					{
						field: 'head_portrait',
						sortable: true,
						title: '头像',
						align: 'left',
						formatter: function (value){
							if (!empty(value)) {
								var img_html = "<a title='点击查看大图' target='_blank' href='"+value+"'><img src='"+value+"' width='30'/></a>";
								return img_html;
								// var strs = "";
								// strs = value.toString().substring(0,10);
								// return strs;
							}
						}
					},
					{
						field: 'grade',
						sortable: true,
						title: '获得评分',
						align: 'left'
					},
					{
						field: 'cname',
						sortable: true,
						title: '服务社区',
						align: 'left'
					},
					{
						field: 'isshow',
						sortable: true,
						title: '是否启用',
						align: 'left'
					},
					{
						field: 'status',
						sortable: true,
						title: '审核状态',
						align: 'left'
					},
					{
						field: 'sequestration',
						sortable: true,
						title: '账号状态',
						align: 'left'
					},
					{
						field: '',
						title: '操作',
						align: 'left',
						formatter: function(value, row, index) {
							//主键id							
							var id = row.id; 
							//名称标题之类的
							var name = row.pet_name;
							//操作显示代码
							var strs = "";
							// var t1 = '<a href = "">初审通过</a>';
							// strs += " " + t1;
							//标记为初审通过
							var oldStatus = row.status;
							var newstatus = 1;
							var status_text = "初审通过";
							// var old_text = ""
							if (oldStatus == "待审核") {
								var shorturl = "{:U('ajax_field_edit')}";
								var short = "<a data-val='" + newstatus + "' data-id='" + id + "' href='javascript:void(0)' data-uri='" + shorturl + "'   onclick='updateField(this)' data-msg='你确认要修改" + name + "的审核状态吗？' >" + status_text + "</a>";
								strs += " " + short;
							}else{
								var short = '<a style="color:#8B2500;">初审已通过</a>';
								strs += " " + short;
							}
							//标记为复审送过
							var oldRecheckStatus = row.status;
							var recheckstatus = 2;
							var recheck_status_text = "复审通过";
							// var old_text = ""
							if (oldRecheckStatus == "初审已通过" || oldStatus == "待审核") {
								if (oldStatus == "待审核") {
									var reminder = "<a href='' onclick='updateField(this)' data-msg='请先修改" + name + "的初审状态！' >"+ recheck_status_text +"</a>";
									strs += " " + reminder;
								}else{
								var recheckurl = "{:U('ajax_field_edit')}";
								var recheck = "<a data-val='" + recheckstatus + "' data-id='" + id + "' href='javascript:void(0)' data-uri='" + recheckurl + "'   onclick='updateField(this)' data-msg='你确认要修改" + name + "的审核状态吗？' >" + recheck_status_text + "</a>";
								strs += " " + recheck;
								}
							}else{
								var recheck = '<a style="color:#8B2500;">复审已通过</a>';
								strs += " " + recheck;
							}							
							//封号
							var oldsequestration = row.sequestration;
							var newsequestration = 1;
							var sequestration_text = "已封号";
							if (oldsequestration == "正常") {
								var unsetUrl = "{:U('unout')}?id=" + id;
								var unset = '<a href="javascript:void(0);" onclick="showDialog(this)"  data-uri="' + unsetUrl + '" data-title="封号" data-width="800" data-height="400" >封号</a>&nbsp;';
								strs += " " + unset;
							}else{
								var unset = '<a style="color:#8B2500;">已封号</a>';
								strs += " " + unset;
							}
							if (oldsequestration == "封号") {
								//解封
								var openUrl = "{:U('open')}?id=" + id;
								var open = '<a href="javascript:void(0);" onclick="showDialog(this)"  data-uri="' + openUrl + '" data-title="解封" data-width="500" data-height="380" >解封</a>&nbsp;';
								strs += " " + open;
							}
							//查看封号记录
							var detUrl = "{:U('Sequestration/indextwo')}?rid=" + id + "&key=2"; 
							var detail = '&nbsp;<a href="javascript:void(0);" onclick="showDialog(this)"  data-uri="' + detUrl + '" data-title="封号记录" data-width="1200" data-height="800" >查看封号记录</a>&nbsp;';
							strs += " " + detail;
							var withholdUrl = "{:U('withhold')}?id=" + id;
							var withhold = '<a href="javascript:void(0);" onclick="showDialog(this)"  data-uri="' + withholdUrl + '" data-title="处罚扣款" data-width="500" data-height="380" >处罚扣款</a>&nbsp;';
							strs += " " + withhold;
							var repairUrl = "{:U('Repair/index')}?id=" + id; 
							var repair = '&nbsp;<a href="javascript:void(0);" onclick="showDialog(this)"  data-uri="' + repairUrl + '" data-title="当前服务人员维修记录" data-width="1200" data-height="800" >查看维修记录</a>&nbsp;';
							strs += " " + repair;
							var fundUrl = "{:U('FundRecord/index')}?uid=" + id; 
							var fundRecord = '&nbsp;<a href="javascript:void(0);" onclick="showDialog(this)"  data-uri="' + fundUrl + '" data-title="资金账户记录" data-width="1200" data-height="800" >查看资金账户记录</a>&nbsp;';
							strs += " " + fundRecord;
							// //编辑
							var editUrl = "{:U('edit')}?id=" + id;
							var edit = '<a href="javascript:void(0);" onclick="showDialog(this)"  data-uri="' + editUrl + '" data-title="编辑" data-width="1000" data-height="800" >编辑</a>&nbsp;';
							strs += " " + edit;
							//删除
							var deleteUrl = "{:U('ajax_delete')}";
							var del = '<a href="javascript:void(0);" onclick="confirmDelete(this)" data-uri="' + deleteUrl + '" data-id="' + id + '" data-msg="确认要将删除' + name + '吗?" >删除</a>';
							strs += " " + del;
							return strs;
						}
					}]
				}));
				/***初始化数据表格 end***/
			});
		</script>
	</body> 
</html>